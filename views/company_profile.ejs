<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/public/css/style.css" />
    <title>Training User</title>
  </head>
  <body>
    <div class="header-background">
      <img
        src="/public/img/company-enterprise-icon.png"
        alt="Avatar"
        class="avatar"
      />
      <h1 class="full-name"><%= data.companyProfileResult[0].name %></h1>
    </div>

    <div class="main-background" id="main-profile">
      <a
        href="/company-profile/<%= data.companyProfileResult[0].company_profile_id %>/contact"
        ><button class="main-boutton" role="button" id="contact-button">
          Contact
        </button></a
      >
      <a
        href="/company-profile/<%= data.companyProfileResult[0].company_profile_id %>/project"
      >
        <button class="main-boutton" role="button" id="project-button">
          Completed project
        </button></a
      >

      <a
        href="/company-profile/<%= data.companyProfileResult[0].company_profile_id %>/opportunities"
      >
        <button class="main-boutton" role="button" id="opportunities-button">
          Opportunities
        </button></a
      >

      <% if (data.contentTypeResult === 'contact') { %>
      <h2>Contacts</h2>
      <!-- Contact Box -->
      <div class="contact-content">
        <% for(let i=0; i < data.contactResult.length ; i++) {%>
        <div class="contact-box">
          <div class="job-title"><%- data.contactResult[i].name %></div>
          <div class="company-name"><%- data.contactResult[i].position %></div>
          <div class="start-date"><%- data.contactResult[i].telephone %></div>
          <div class="description"><%- data.contactResult[i].email %></div>
          <form
            action="/delete-company-contact/<%= data.companyProfileResult[0].company_profile_id %>"
            method="post"
            id="delete-company-experience"
          >
            <input
              type="hidden"
              name="company_contact_id"
              value="<%= data.contactResult[i].company_contact_id %>"
            />
            <button type="submit" id="delete-company-experience">Delete</button>
          </form>
        </div>
        <%}; %>
        <button class="main-boutton" id="add-contact-button">
          Add contact
        </button>
      </div>
      <% } else if (data.contentTypeResult === 'project') { %>
      <h2>Project</h2>
      <!-- Project Box -->
      <div class="project-content">
        <% for(let i=0; i < data.projectResult.length ; i++) {%>
        <div class="project-box">
          <div class="job-title"><%- data.projectResult[i].title %></div>
          <div class="company-name">
            <%- data.projectResult[i].start_date %>
          </div>
          <div class="start-date"><%- data.projectResult[i].end_date %></div>
          <div class="description">
            <%- data.projectResult[i].description %>
          </div>
          <form
            action="/delete-company-project"
            method="POST"
            id="delete-company-project-form"
          >
            <input
              type="hidden"
              name="company_profile_id"
              value="<%= data.companyProfileResult[i].company_profile_id %>"
            />
            <input
              type="hidden"
              name="company_project_id"
              value="<%= data.projectResult[i].company_project_id %>"
            />
            <button
              type="submit"
              class="delete-company-experience"
              id="delete-company-project-button"
            >
              Delete
            </button>
          </form>
        </div>
        <%}; %>
        <button class="main-boutton" id="add-project-button">
          Add project
        </button>
      </div>
      <% } else if (data.contentTypeResult === 'opportunities') { %>
      <h2>Opportunities</h2>
      <!-- Opportunities Box -->
      <div class="opportunities-content">
        <% for(let i=0; i < data.opportunitesResult.length ; i++) {%>
        <div class="opportunities-box">
          <div class="job-title"><%- data.opportunitesResult[i].title %></div>
          <div class="company-name">
            <%- data.opportunitesResult[i].consultant %>
          </div>
          <div class="start-date">
            <%- data.opportunitesResult[i].certification %>
          </div>
          <div class="description">
            <%- data.opportunitesResult[i].history %>
          </div>
          <form>
            <input
              type="hidden"
              name="company_profile_id"
              value="<%= data.companyProfileResult[i].company_profile_id %>"
            />
            <input
              type="hidden"
              name="company_project_id"
              value="<%= data.projectResult[i].company_project_id %>"
            />
            <button type="submit" id="delete-company-experience">Delete</button>
          </form>
        </div>
        <%}; %>
        <button class="main-boutton" id="add-opportunities-button">
          Add opportunities
        </button>
      </div>
      <% }%>
    </div>
    <!-- Contact Modal -->
    <div
      class="modal modal-dialog-scrollable"
      style="display: none"
      id="add-contact-modal"
    >
      <div class="contact-modal">
        <span class="close" id="close-modal-contact">&times;</span>
        <h2>Add contact</h2>
        <form
          action="/add-company-contact/<%=
        data.companyProfileResult[0].company_profile_id %>"
          method="post"
          class="is-editing"
          class="official-form"
          id="editUserForm"
        >
          <label for="contact-name">Name :</label>
          <input
            type="text"
            id="contact-name"
            name="name"
            class="official-input"
            required
          /><br />

          <label for="contact-position">Position :</label>
          <input
            type="text"
            id="contact-position"
            name="position"
            class="official-input"
            required
          /><br />

          <label for="contact-description"> Telephone :</label>
          <input
            type="text"
            id="contact-description"
            name="telephone"
            class="official-input"
            required
          /><br />

          <label for="contact-email"> email :</label>
          <input
            type="text"
            id="contact-email"
            name="email"
            class="official-input"
            required
          /><br />

          <input
            type="submit"
            value="Save"
            class="main-boutton"
            id="add_experience"
          />
        </form>
      </div>
    </div>
    <!-- Project Modal -->
    <div
      class="modal modal-dialog-scrollable"
      style="display: none"
      id="add-project-modal"
    >
      <div class="project-modal">
        <span class="close" id="close-modal-project">&times;</span>
        <h2>Add Project</h2>
        <form
          action="/add-company-project/<%=
      data.companyProfileResult[0].company_profile_id %>"
          method="post"
          class="is-editing"
          class="official-form"
          id="editUserForm"
        >
          <label for="title">title :</label>
          <input
            type="text"
            id="title"
            name="title"
            class="official-input"
            required
          /><br />

          <label for="start-date">Start date :</label>
          <input
            type="date"
            id="start-date"
            name="start_date"
            class="official-input"
            required
          /><br />

          <label for="end-date"> End date :</label>
          <input
            type="date"
            id="end-date"
            name="end_date"
            class="official-input"
            required
          /><br />

          <label for="description"> Description :</label>
          <input
            type="text"
            id="description"
            name="description"
            class="official-input"
            required
          /><br />

          <input
            type="submit"
            value="Save"
            class="main-boutton"
            id="add_experience"
          />
        </form>
      </div>
    </div>

    <!-- Opportunites Modal -->
    <div
      class="modal modal-dialog-scrollable"
      style="display: none"
      id="add-opportunities-modal"
    >
      <div class="project-modal">
        <span class="close" id="close-modal-project">&times;</span>
        <h2>Add Opportunites</h2>
        <form
          action="/add-opportunites-project/<%=
        data.companyProfileResult[0].company_profile_id %>"
          method="post"
          class="is-editing"
          class="official-form"
          id="editUserForm"
        >
          <label for="title">Title :</label>
          <input
            type="text"
            id="title"
            name="title"
            class="official-input"
            required
          /><br />

          <label for="start-date">Consultant :</label>
          <input
            type="text"
            id="start-date"
            name="start_date"
            class="official-input"
            required
          /><br />

          <label for="end-date"> Certification :</label>
          <input
            type="text"
            id="end-date"
            name="end_date"
            class="official-input"
            required
          /><br />

          <label for="description"> History :</label>
          <input
            type="text"
            id="description"
            name="description"
            class="official-input"
            required
          /><br />

          <input
            type="submit"
            value="Save"
            class="main-boutton"
            id="add_experience"
          />
        </form>
      </div>
    </div>
    <button id="myButton">Cliquez-moi</button>
  </body>
</html>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    //Button
    const addContactButton = document.getElementById("add-contact-button");
    const addProjectButton = document.getElementById("add-project-button");
    const addOpportunitiesButton = document.getElementById(
      "add-opportunities-button"
    );
    const contactButton = document.getElementById("contact-button");
    const projectButton = document.getElementById("project-button");
    const opportunitesButton = document.getElementById("opportunities-button");
    const deleteProjectButton = document.getElementById(
      "delete-company-project-button"
    );

    //Box
    const contactBox = document.querySelector(".contact-content");
    const projectBox = document.querySelector(".project-content");
    const opportunitiesBox = document.querySelector(".opportunities-content");
    //Modal
    const addContactModal = document.getElementById("add-contact-modal");
    const addProjectModal = document.getElementById("add-project-modal");
    const addOpportunitiesModal = document.getElementById(
      "add-opportunities-modal"
    );
    const closeModalContact = document.getElementById("close-modal-contact");
    const closeModalProject = document.getElementById("close-modal-project");

    //Add element
    addContactButton.addEventListener("click", () => {
      addContactModal.style.display = "block";
      console.log("rezq");
    });

    if (addOpportunitiesButton) {
      addOpportunitiesButton.addEventListener("click", () => {
        addOpportunitiesModal.style.display = "block";
      });
    }

    const myButton = document.getElementById("myButton");

    myButton.addEventListener("click", function () {
      console.log("Le bouton a été cliqué !");
    });

    if (addProjectButton) {
      addProjectButton.addEventListener("click", () => {
        addProjectModal.style.display = "block";
      });
    }

    //Close modal
    closeModalContact.addEventListener("click", () => {
      addContactModal.style.display = "none";
    });

    window.onclick = (event) => {
      if (event.target === addContactModal) {
        addContactModal.style.display = "none";
      }
      if (event.target === addProjectModal) {
        addProjectModal.style.display = "none";
      }
    };

    closeModalProject.addEventListener("click", () => {
      addProjectModal.style.display = "none";
    });

    if (deleteProjectButton) {
      deleteProjectButton.addEventListener("click", function (event) {
        event.preventDefault(); // Empêche le comportement par défaut du formulaire
        let formData = new FormData(
          document.getElementById("delete-company-project-form")
        );

        fetch("/delete-company-project", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: new URLSearchParams(formData).toString(),
        })
          .then(() => {
            setTimeout(() => {
              window.location.reload();
            }, 150);
            window.addEventListener("load", updateUI);
          })
          .catch((error) => {
            // Handle error
            console.error(
              "There has been a problem with your fetch operation:",
              error
            );
          });
      });
    }
  });
</script>
